---
layout: post
title: n8n 初学笔记
date: 2025-10-21 12:00:00
forType: Workflow
category: n8n
tag: [n8n, 工作流自动化, 初学, 教程, 集成]
---

* content
{:toc}

# n8n 初学笔记概览

面向首次接触 n8n 的开发人员，快速理解 n8n 的定位、核心概念与使用路径，并可用于项目落地与实践参考。

## 入门指南

### n8n 是什么
n8n 是一个可视化、低代码的工作流自动化与集成平台。通过拖拽节点进行编排，开发者可以在不编写大量胶水代码的情况下，实现跨系统的数据流转与自动化。其特点包括：
- 可视化与低代码：拖拽节点、连线即可构建流程
- 节点生态丰富：内置大量常用服务与协议节点（HTTP、数据库、邮件等）
- 开源与自托管：支持本地/服务器部署，易于二次定制
- 可扩展：支持自定义 Function/Code 节点，表达式灵活

### 适用场景
- 数据同步：CRM → 数据仓库、第三方 API → 内部系统
- API 编排：组合多个第三方接口形成统一服务
- 通知告警：异常日志触发短信/邮件/IM 通知
- 轻量 ETL：定时采集、清洗、落库（适合中小规模）
- 内部自动化：审批流辅助、报表生成与推送

小示例：
- HTTP Webhook 接收事件 → Function 清洗数据 → 发送到 Slack/企业微信

### 学习路径
1. 安装：使用 Docker 快速启动 n8n
2. 核心概念：理解工作流、节点、触发器、表达式与凭据
3. 上手实践：构建第一个工作流（HTTP Trigger → Function → 通知）

## 安装与环境

### Docker 安装与启动（仅 Docker 方式）

#### 前置要求
- 已安装 Docker（建议 20+）与 Docker Compose（V2）
- 服务器/本机开放端口 `5678`（默认 Web 端口）

#### 快速启动（单容器）
```bash
# 创建数据持久化目录（macOS/Linux 示例）
mkdir -p ~/.n8n

# 启动 n8n 容器（最小可用示例）
docker run -it --rm \
  -p 5678:5678 \
  -v ~/.n8n:/home/node/.n8n \
  -e N8N_HOST=localhost \
  -e N8N_PORT=5678 \
  --name n8n \
  n8nio/n8n:latest
```
访问地址：`http://localhost:5678`（首次进入创建管理员）。

#### 推荐：Docker Compose
```yaml
# docker-compose.yml
version: "3.8"
services:
  n8n:
    image: n8nio/n8n:latest
    container_name: n8n
    ports:
      - "5678:5678"
    environment:
      - N8N_HOST=localhost
      - N8N_PORT=5678
      - N8N_PROTOCOL=http
      # 反向代理/公网时需要：
      # - WEBHOOK_URL=http://your-domain-or-ip:5678/
      - TZ=Asia/Shanghai
    volumes:
      - ./n8n_data:/home/node/.n8n
    restart: unless-stopped
```
启动：
```bash
docker compose up -d
```

#### 数据持久化与备份
- 工作流、凭据等保存在挂载目录（示例：`./n8n_data`）
- 定期备份该目录即可完成迁移与恢复

#### 反向代理提示
- 使用 Nginx/Caddy 等做反向代理时，务必正确设置 `WEBHOOK_URL`
- HTTPS/域名场景下：`WEBHOOK_URL=https://your-domain/`

#### 常见问题
- 端口冲突：检查本机是否已有服务占用 `5678`
- 访问异常：反向代理未正确转发或未设置 `WEBHOOK_URL`
- 权限问题：挂载目录需对 Docker 进程可读写

## 核心概念

### 工作流（Workflow）与节点（Node）
- 工作流：由多个节点组成的有向图，通过连线决定执行顺序
- 节点：执行具体任务的单元（如 HTTP Request、Function、Set 等）
- 数据流：节点之间传递 `items`（JSON 对象数组），每个节点对输入进行处理并产生输出

### 触发器（Trigger）与执行（Execute）
- 触发器节点：如 Webhook、Schedule（Cron）、IMAP 等，用于“启动”工作流
- 手动执行：编辑器中点击“执行工作流”进行调试
- 运行方式：触发 → 依次执行下游节点 → 根据分支/条件流转

### 数据结构与表达式
- 数据结构：每个节点的输出通常是 `items: [{ json: {...} }]`
- 表达式：在字段中输入表达式以引用数据，例如：
  - `{{$json.name}}` 引用当前节点输入中的 `name`
  - `{{$node["HTTP Request"].json.status}}` 引用指定节点输出
  - `{{$flow.static}}` 引用工作流级变量，`{{$env.VAR}}` 引用环境变量
- 示例（Set 节点）：
```json
{
  "name": "{{$json.name}}",
  "status": "{{$node[\"HTTP Request\"].json.status}}",
  "ts": "{{$now}}"
}
```

### 凭据（Credentials）与连接配置
- 凭据：用于安全存储第三方服务的认证信息（API Key、OAuth2、Basic Auth 等）
- 使用方式：在节点中选择已保存的凭据，即可复用连接配置
- 最佳实践：使用环境变量注入敏感信息、限制权限、定期轮换密钥
